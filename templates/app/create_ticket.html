{% extends "base.html" %}
      {% block css %}
<link rel="stylesheet" href="/static/bower_components/jquery.steps/demo/css/jquery.steps.css">
<link rel="stylesheet" href="/static/bower_components/datetimepicker/build/jquery.datetimepicker.min.css">
          <link rel="stylesheet" href="/static/bower_components/select2/dist/css/select2.min.css">
          <link rel="stylesheet" href="/static/bower_components/toastr/toastr.min.css">
{% endblock %}
{% block content %}
       <nav aria-label="You are here:" role="navigation">
  <ul class="breadcrumbs">
    <li><a href="#">首页</a></li>
    <li><a href="#">新增工单</a></li>
  </ul>
</nav>
       <div id="wizard">
        <h3>第一步</h3>
        <section>
          <div class="row">
            <div class="medium-6 columns">
              <label>项目名称
                <input type="text" placeholder="项目名称" name="pro_name">
              </label>
            </div>
              <div class="medium-6 columns">
                  <div id="select-sales-content"></div>
              </div>
                            <div class="medium-6 columns">

                                <div id="select-customers-content"></div>
                                              </div>
                            <div class="medium-6 columns">
                                <div id="select-products-content"></div>
               </div>
                            <div class="medium-6 columns">
                                <div id="select-areas-content"></div>
               </div>

          </div>
        </section>
        <h3>第二步</h3>
        <section>
            <div class="row">
                <div class="" id="select_class">
                    <label for="">选择分类I
                        <select name="" id="" class="class1">
                            <option value=""></option>
                        </select>
                    </label>
                    <label for="">选择分类II
                        <select name="" id="" class="class2">
                            <option value=""></option>
                        </select>
                    </label>
                    <label for="">选择分类III
                        <select name="" id="" class="class3">
                            <option value=""></option>
                        </select>
                    </label>
                    <label for="">选择分类IV
                        <select name="" id="" class="class4">
                            <option value=""></option>
                        </select>
                    </label>
                </div>
            </div>
        </section>
        <h3>第三步</h3>
        <section>
            <div class="row">
                <div class="medium-6 columns">
                    <div id="select-engineers-content"></div>
                </div>
                <div class="medium-6 columns">
                  <label>日期
                    <input type="text" placeholder="选择日期" id="datetimepicker">
                  </label>
                </div>
            </div>
        </section>
    </div>
{% endblock %}
{% block js %}
    <script src="/static/bower_components/jquery.steps/build/jquery.steps.min.js"></script>
    <script src="/static/bower_components/datetimepicker/build/jquery.datetimepicker.full.min.js"></script>
    <script src="/static/bower_components/select2/dist/js/select2.min.js"></script>
    <script src="/static/bower_components/jquery.cxselect/jquery.cxselect.min.js"></script>
    <script src="/static/bower_components/toastr/toastr.min.js"></script>
    <script src="/static/bower_components/art-template/lib/template-web.js"></script>
    <script id="select-customers" type="text/html">
      <label for="">选择客户
        <select name="" id="" class="select-customers">
            <% for (var i = 0; i < list.length; i ++) { %>
                <option value="<%= i + 1 %>"><%= list[i].name %></option>
            <% } %>
            data: <%=$data%>
        </select>
      </label>
    </script>
    <script id="select-sales" type="text/html">

    <label for="">选择销售
        <select name="" id="" class="select-sales">
            <% for (var i = 0; i < list.length; i ++) { %>
                <option value="<%= list[i].id %>"><%= list[i].name %></option>
            <% } %>
            data: <%=$data%>
        </select>
              </label>

    </script>
    <script id="select-products" type="text/html">
        <label for="">选择主导产品
        <select name="" id="" class="select-products">
            <% for (var i = 0; i < list.length; i ++) { %>
                <option value=""><%= list[i].name %></option>
            <% } %>
            data: <%=$data%>
        </select>
              </label>
</script>
    <script id="select-areas" type="text/html">
            <label for="">选择服务区域
        <select name="" id="" class="select-areas">
            <% for (var i = 0; i < list.length; i ++) { %>
                <option value=""><%= list[i].name %></option>
            <% } %>
            data: <%=$data%>
        </select>
              </label>
</script>
    <script id="select-engineers" type="text/html">
        <label for="">选择工程师
            <select name="" id="" class="select-engineers">
                <% for (var i = 0; i < list.length; i ++) { %>
                    <option value=""><%= list[i].name %></option>
                <% } %>
                data: <%=$data%>
            </select>
        </label>
    </script>
    <script>

    $(function () {
        $.getJSON(API_URI["customers"]).done(function (res) {
            var data = {
                list: res["objects"]
            };
            var html = template('select-customers', data);
            document.getElementById('select-customers-content').innerHTML = html;
                    $(".select-customers").select2();

        });

        $.getJSON(API_URI["sales"]).done(function (res) {
            var data = {
                list: res["objects"]
            };
            var html = template('select-sales', data);
            document.getElementById('select-sales-content').innerHTML = html;
            $(".select-sales").select2();

        });

        $.getJSON(API_URI["engineers"]).done(function (res) {
            var data = {
                list: res["objects"]
            };
            var html = template('select-engineers', data);
            document.getElementById('select-engineers-content').innerHTML = html;
            $(".select-engineers").select2();

        });

        $.getJSON(API_URI["products"]).done(function (res) {
            var data = {
                list: res["objects"]
            };
            var html = template('select-products', data);
            document.getElementById('select-products-content').innerHTML = html;
            $(".select-products").select2();

        });


        $.getJSON(API_URI["areas"]).done(function (res) {
            var data = {
                list: res["objects"]
            };
            var html = template('select-areas', data);
            document.getElementById('select-areas-content').innerHTML = html;
            $(".select-areas").select2();

        });

        $("#wizard").steps({
            headerTag: "h3",
            bodyTag: "section",
            transitionEffect: "slideLeft",
            autoFocus: true,
            labels: {
                cancel: "取消",
                current: "current step:",
                pagination: "Pagination",
                finish: "提交",
                next: "下一步",
                previous: "上一步",
                loading: "加载中 ..."
            },
            onFinished: function (event, currentIndex) {
                console.log(event);
                console.log(currentIndex);
                toastr.success('已完成');
                console.log($("select.select-sales").select2("data")[0]);
            var sales = $(".select-sales").select2("data")[0];
            var customers = $(".select-customers").select2("data")[0];
            var products = $(".select-products").select2("data")[0];
            var areas = $(".select-areas").select2("data")[0];
            var engineers = $(".select-engineers").select2("data")[0];
                var datetime = $("#datetimepicker").datetimepicker('getValue');
                var pro_name = $("input[name='pro_name']").val();
                console.log(datetime);

                //$.post().done(function (res) {

                //})
        }
        });

        $('#datetimepicker').datetimepicker();

        $(".select-products").select2();
        $(".select-areas").select2();

        //级联

        $.getJSON(API_URI["templates2"]).done(function (res) {


         $('#select_class').cxSelect({
              selects: ['class1', 'class2', 'class3', 'class4'],  // 数组，请注意顺序
              jsonName: 'name',
              jsonValue: 'value',
              jsonSub: 'sub',
              emptyStyle: 'none',
              data: [
                {name:'A', value: '1', sub: [
                  {name: 'A-1', value: '2', sub: [
                    {name: 'A-1-1', value: '11'}
                    // more..
                  ]},
                  {name: 'A-2', value: '3', sub: [
                    {name: 'A-2-1', value: '34'}
                  ]}
                  // more..
                ]},
                {name:'B', value: '5', sub: [
                  {name: 'B-1', value: '8', sub: [
                    {name: 'B-1-1', value: '16'}
                  ]}
                ]}
              ]
            });
        });

    });

    </script>
{% endblock%}